# this code snippet MUST be placed at the end of Dockerfile.
ARG HUGO_EXTENDED=

# libc6-compat & libstdc++ are required for extended SASS libraries
RUN if [[ -n "$HUGO_EXTENDED" ]]; then apk add --no-cache libc6-compat libstdc++; fi

RUN apk add --update --no-cache ca-certificates

# copy Hugo binary from builder.
COPY --from=builder /usr/bin/hugo /usr/bin/hugo

# working directory.
RUN mkdir /src
WORKDIR /src

# create non-root user
RUN deluser --remove-home node || true
RUN addgroup -g 1000 hugo \
  && adduser -u 1000 -G hugo -s /bin/sh -D hugo
RUN chown -R hugo:hugo /src
USER hugo:hugo

# default command.
CMD hugo env
